/****************************************************************************
 *                                                                          *
 *  Author : lukasz.iwaszkiewicz@gmail.com                                  *
 *  ~~~~~~~~                                                                *
 *  License : see COPYING file for details.                                 *
 *  ~~~~~~~~~                                                               *
 ****************************************************************************/

module;
#include <any>
#include <functional>
#include <string>
export module logic.core:event;

namespace logic {

/**
 * One off event.
 */
export struct IEvent {
        IEvent () = default;
        IEvent (IEvent const &) = default;
        IEvent &operator= (IEvent const &) = default;
        IEvent (IEvent &&) noexcept = default;
        IEvent &operator= (IEvent &&) noexcept = default;
        virtual ~IEvent () = default;
        // Returns if the call was successful.
        virtual bool execute (std::any const &func) const = 0;
};

/**
 *
 */
export class AbstractNullaryEvent : public IEvent {
public:
        bool execute (std::any const &func) const override
        {
                auto f = std::any_cast<std::function<void ()>> (func);
                f ();
                return true;
        }
};

/**
 *
 */
export class ErrorEvent : public IEvent {
public:
        explicit ErrorEvent (std::string message) : message{std::move (message)} {}

        bool execute (std::any const &func) const override
        {
                auto f = std::any_cast<std::function<void (std::string const &)>> (func);
                f (message);
                return true;
        }

private:
        std::string message;
};

} // namespace logic